// Copyright (c) 2025 CyberCortex Robotics SRL. All rights reserved
// Author: Sorin Mihai Grigorescu

// SLAM simulation:
//  - Set Camera interface to sim
//  - Set VisualSlam tracker to sim
//  - Set VehicleSimulator ReplayFromDB = false

Core:
{
    ID                  = 1
    BasePath            = ".."
    #BasePath            = "/home/ubuntu/dev/src/CyberCortex.AI/core"
    StartupFiltersView  = [200, 201]
    Filters             = "bin/filters"
    LogFile             = "logs/log.log"
    ReplayDB            = "c:/data/rgbd/icdt_l6_01"
}
Filters =
{
    DataChannel:
    {
        ID              = 1000
        Active          = False
        Type            = "CyC_COM_DATACHANNEL_FILTER_TYPE"
        InputSources    = (
                            {FilterID = 1, Description = "CAM 1"},
                            {FilterID = 50, Description = "Vehicle terminal"},
                            {FilterID = 53, Description = "Control input"},
                            {FilterID = 200, Description = "SensingViz"},
                            {FilterID = 201, Description = "VehicleViz"},
                          )
        dt              = 0.001
        dt_Sequencing   = 0.1
        Parameters      = ({name="signaling_uri", value="wss://sig.cybercortex.ai:1920"})
    }
    Camera:
    {
        ID              = 1
        Active          = True
        Type            = "CyC_RGBDCAMERA_FILTER_TYPE"
        IsPublishable   = True
        ReplayFromDB    = True
        dt              = 0.01
        dt_Sequencing   = 0.1
        InputSources    = ({FilterID = 55, Description = "Robot state / pose"})
        Parameters      = (
                            {name = "interface", value = "realsense"}, # sim, realsense, openni, unity
                            {name = "ip", value = "127.0.0.1"},
                            {name = "port", value = "2004"},
                            {name = "CalibrationFile", value = "etc/calibration/cam/cam_rs_d455_231122300048.cal"},
                            {name = "Rectify", value = "False"},
                            #{name = "voxels", value = "etc/env/voxels.csv"},
                          )
    }
    Lidar:
	{
        ID              = 7
        Active          = False
        Type            = "CyC_LIDAR_FILTER_TYPE"
        IsPublishable   = True
        ReplayFromDB    = True
        dt              = 0.01
        dt_Sequencing   = 0.1
        InputSources    = ()
        Parameters      = (
                            {name = "interface", value = "lslidar"}, # sim, hessai, rp, slamware, lslidar
                            {name = "port", value = "/dev/ttyACM0"}, # lslidar: "\\\\.\\COM4" or "/dev/ttyACM0"
                            {name = "CalibrationFile", value = "etc/calibration/lidar/lslidar.cal"}
                          )
	}
    Imu:
    {
        ID              = 8
        Active          = True
        Type            = "CyC_IMU_FILTER_TYPE"
        IsNetworkFilter = False
        IsPublishable   = True
        ReplayFromDB    = True
        dt              = 0.01
        dt_Sequencing   = 0.05
        InputSources    = ()
        Parameters      = (
                            {name = "interface", value = "realsense"}, // sim, realsense, MPU9250, brick, android, unitree_a1, unity
                            {name = "calibration", value = "etc/calibration/imu/imu_rs_d455_231122300048.cal"},
                            {name = "PortNr", value = "4"}
                          )
    }
    VisualSlam:
    {
        ID              = 30
        Active          = True
        Type            = "CyC_VISUAL_SLAM_FILTER_TYPE"
        IsPublishable   = False
        ReplayFromDB    = False
        dt              = 0.03
        dt_Sequencing   = 0.1
        InputSources    = (
                            {FilterID = 1, Description = "Input image"},
                            {FilterID = 8, Description = "Imu sensor"},
                            {FilterID = 50, Description = "Vehicle terminal"},
                          )
        Parameters      = (
                            {name = "slam_type", value = "rgbd"},
                            {name = "tracker", value = "orb"},      # sim, orb, vilib
                            {name = "matcher", value = "bitwise"},  # bitwise, L2, lightglue
                            {name = "dnn_matcher", value = "../../RovisLab/Filters_DNNs/DNN_PointsDetection/DNN_PointsMatching.conf"},
                            {name = "voxels", value = "etc/env/voxels.csv"},
                            {name = "map", value = "etc/env/maps/exploratory.map"},
                            {name = "save", value = "etc/env/maps/exploratory.map"},
                            {name = "build_map", value = "True"},
                            {name = "vocab", value = "etc/env/ORBvoc.fbow"},
                            {name = "initial_pose", value="0.0, 0.0, 0.0, 0.0, 0.0, 0.0"},
                          )
    }
    SensorFusion:
    {
        ID              = 40
        Active          = True
        Type            = "CyC_SENSOR_FUSION_MODEL_FILTER_TYPE"
        IsPublishable   = False
        ReplayFromDB    = False
        dt              = 0.03
        dt_Sequencing   = 0.1
        InputSources    = (
                            #{FilterID = 1, Description = "Input image"},
                            #{FilterID = 7, Description = "Lidar"},
                            #{FilterID = 30, Description = "Visual Slam"},
                            {FilterID = 55, Description = "Robot pose"}
                          )
        Parameters      = (
                            {name = "resolution", value = "0.25"},
                            {name = "depth_range", value = "50.0"},
                            {name = "ground_th", value = "0.5"},
                            {name = "sealing_th", value = "2.0"},
                            {name = "accumulate", value = "False"}
                          )
    }
    Map:
    {
        ID              = 47
        Active          = True
        Type            = "CyC_MAP_FILTER_TYPE"
        IsPublishable   = True
        ReplayFromDB    = False
        dt              = 0.1
        dt_Sequencing   = 0.1
        InputSources    = (
                            {CoreID = 1, FilterID = 40, Description = "Sensor fusion"}
                          )
        Parameters      = (
                            {name = "resolution", value = "0.25"},
                            {name = "accumulate", value = "False"}
                          )
    }
    VehicleMissionPlanner:
    {
        ID              = 49
        Active          = True
        Type            = "CyC_VEHICLE_MISSION_PLANNER_FILTER_TYPE"
        IsPublishable   = False
        ReplayFromDB    = False
        dt              = 0.1
        InputSources    = (
                            {FilterID = 50, Description = "Vehicle terminal"},
                            {FilterID = 55, Description = "Robot state / pose"}
                          )
        Parameters      = (
                            {name = "reference_path", value = "etc/missions/dynamic_mission.csv"},
                            #{name = "reference_path", value = "etc/missions/indoor/l6.csv"},
                          )
    }
    Terminal_Vehicle:
    {
        ID              = 50
        Active          = True
        Type            = "CyC_TERMINAL_VEHICLE_FILTER_TYPE"
        IsNetworkFilter = True
        IsPublishable   = True
        ReplayFromDB    = False
        dt              = 0.1
        dt_Sequencing   = 0.1
        InputSources    = ({CoreID=10000, FilterID=0, Description="Browser"})
        Parameters      = (
                            {name = "default_cmd", value = "drive"},
                            {name = "destinations", value = "{[2.0, -2.0, 0.0], Workbench}; {[-8.0, 4.0, 0.0], Loading area}"}
                          )
    }
    VehicleController:
    {
        ID              = 52
        Active          = True
        Type            = "CyC_VEHICLE_CONTROL_FILTER_TYPE"
        IsPublishable   = False
        ReplayFromDB    = False
        dt              = 0.2
        dt_Sequencing   = 0.1
        InputSources    = (
                            {CoreID = 1, FilterID = 47, Description = "Map"},
                            {CoreID = 1, FilterID = 49, Description = "Vehicle mission planner"},
                            #{CoreID = 1, FilterID = 51, Description = "LocalPlanner"},
                            {CoreID = 1, FilterID = 55, Description = "Vehicle state estimation"},
                          )
        Parameters      = (
                            {name = "ControllerType", value = "dwa"},   # manual, PP, MPC, LQR, skid, dwa
                            {name = "vehicle_model", value = "etc/kinematics/vehicles/vehicle_scout.conf"},
                            {name = "ReferenceSpeed", value = "0.3"},
                            {name = "LookaheadDistance", value = "1.0"},
                            {name = "goal_distance", value = "0.75"},
                          )
    }
    VehicleActuator:
    {
        ID              = 53
        Active          = True
        Type            = "CyC_VEHICLE_ACTUATOR_FILTER_TYPE"
        IsPublishable   = True
        ReplayFromDB    = False
        dt              = 0.001
        InputSources    = (
                            {CoreID = 1, FilterID = 50, Description = "Vehicle terminal"},
                            {CoreID = 1, FilterID = 52, Description = "Vehicle controller"}
                          )
        Parameters      = (
                            {name = "interface", value = "sim"},          # sim, unity, scout
                            {name = "device_name", value="/dev/ttyUSB0"},   # for scout
                            {name = "ip", value = "127.0.0.1"},
                            {name = "port", value = "2003"}
                          )
    }
    VehicleSimulator:
    {
        ID              = 54
        Active          = True
        Type            = "CyC_VEHICLE_SIMULATION_FILTER_TYPE"
        IsPublishable   = True
        ReplayFromDB    = False
        dt              = 0.001
        InputSources    = (
                            {CoreID = 1, FilterID = 53, Description = "Vehicle actuator"}
                          )
        Parameters      = (
                            {name = "vehicle_model", value = "etc/kinematics/vehicles/vehicle_scout.conf"},
                            {name = "initial_state", value="1.0, 0.0, 0.0, 0.0, 0.0"},
                          )
    }
    VehicleStateEstimation:
    {
        ID              = 55
        Active          = True
        Type            = "CyC_VEHICLE_STATE_ESTIMATION_FILTER_TYPE"
        IsNetworkFilter = False
        IsPublishable   = True
        ReplayFromDB    = False
        dt              = 0.001
        InputSources    = (
                            #{CoreID = 1, FilterID = 54, Description = "Vehicle SIMULATION"},
                            {CoreID = 1, FilterID = 30, Description = "Visual SLAM"}
                          )
        Parameters      = (
                            {name = "interface", value = "real"}, # sim, unity, real
                            {name = "vehicle_model", value = "etc/kinematics/vehicles/vehicle_scout.conf"},
                            {name = "initial_state", value = "0.0, 0.0, 0.0, 0.0, 0.0"},
                          )
    }
    SensingViz:
    {
        ID              = 200
        Active          = True
        Type            = "CyC_VIZ_SENSING_FILTER_TYPE"
        IsNetworkFilter = False
        IsPublishable   = True
        ReplayFromDB    = False
        dt              = 0.1
        dt_Sequencing   = 0.1
        InputSources    = (
                            {CoreID = 1, FilterID = 1, Description = "Image cam 1"},
                            {CoreID = 1, FilterID = 30, Description = "Visual SLAM"},
                            #{CoreID = 1, FilterID = 40, Description = "Map"},
                          ) 
        Parameters      = (
                            {name = "object_classes", value = "etc/env/classes/object_classes_ms_coco.conf"},
                            {name = "gray_viz", value = "True"},
                            {name = "width", value = "1000"},
                            {name = "height", value = "580"},
                            {name = "bew_scale", value = "75"},
                          )
    }
    VehicleViz:
    {
        ID              = 201
        Active          = True
        Type            = "CyC_VIZ_VEHICLE_FILTER_TYPE"
        IsNetworkFilter = False
        IsPublishable   = True
        ReplayFromDB    = False
        dt              = 0.1
        InputSources    = (
                            {CoreID = 1, FilterID = 30, Description = "Visual SLAM"},
                            {CoreID = 1, FilterID = 47, Description = "Map"},
                            {CoreID = 1, FilterID = 49, Description = "Vehicle mission planner"},
                            #{CoreID = 1, FilterID = 51, Description = "Vehicle local planner"},
                            {CoreID = 1, FilterID = 52, Description = "Vehicle controller"},
                            {CoreID = 1, FilterID = 55, Description = "Vehicle state estimation"},
                          )
        Parameters      = (
                            #{name = "voxels", value = "etc/env/voxels.csv"},
                            {name = "main_vehicle", value = "1-55"}
                          )
    }
    Octoviz:
    {
        ID              = 300
        Active          = False
        Type            = "CyC_VIZ_OCTOVIZ_FILTER_TYPE"
        IsNetworkFilter = False
        IsPublishable   = True
        ReplayFromDB    = False
        dt              = 0.1
        dt_Sequencing   = 0.1
        InputSources    = (
                            #{FilterID = 30, Description = "Visual SLAM"},
                            #{FilterID = 70, Description = "Drone state"},
                            {FilterID = 47, Description = "Map"},
                            {FilterID = 49, Description = "Mission planner"},
                            #{FilterID = 51,  Description = "Local planner"},
                            {FilterID = 55, Description = "Vehicle state"},
                          ) 
        Parameters      = () #{name = "world_coord", value = "55"})
    }
}
